@model IEnumerable<DataLayer.Model.Students.IndexModel>

<h2>Student List</h2>
<hr />
<button type="button" id="createStudent" class="btn btn-primary mb-5" data-mdb-ripple-init>Create</button>

<table id="studentListTable" class="table table-striped">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.FullName)
            </th>
            <th>Class</th>
            <th>
                @Html.DisplayNameFor(model => model.Address)
            </th>
            <th>Options</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.FullName)
                </td>
                <td>
                    @if (item.Classes != null)
                    {
                        @foreach (var c in item.Classes)
                        {
                            <a asp-controller="Classes" asp-action="Details" asp-route-id="@c.Id">@c.Name | </a>
                        }
                    }
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Address)
                </td>
                <td>
                    <button type="button" class="btn btn-primary w-0">Edit</button> 
                    <button type="button" class="btn btn-info w-0">
                        Detail
                    </button>
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-danger w-0 delete-student">
                        <a asp-action="Delete" asp-route-id="@item.Id" onclick="return false;" class="text-white">Delete</a>
                    </button>

                </td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.FullName)
            </th>
            <th>Class</th>
            <th>
                @Html.DisplayNameFor(model => model.Address)
            </th>
            <th>Options</th>
        </tr>
    </tfoot>
</table>

<script>
    $(document).ready(() => {
        new DataTable('#studentListTable', {
            lengthMenu: [
                [5, 10, 25, -1],
                [5, 10, 25, 'All']
            ],
        });

        // form create
        $('#createStudent').on('click', () => {
            console.log('@Url.Action("Create", "Students")')
            $('.partial').load('@Url.Action("Create", "Students")');
        })

        // form edit
        $.each($('.btn btn-danger.w-0.delete-student'), (key, val) => {
            val.addEventListener('click', () => {
                var id = val.getAttribute('id').split('-')[1];
                $('#delete-' + id).click(function (e) {
                    console.log(val)
                    var valData = {};
                    valData.id = id;
                    $.ajax({
                        url: "/Students/Delete/" + id,
                        headers: { "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val() },
                        type: "DELETE",
                        contentType: "application/x-www-form-urlencoded;charset=utf-8",
                        dataType: "JSON",
                        data: valData,
                        success: function (data) {
                            console.log(data)
                            $.toast({
                                heading: 'Success',
                                text: 'Successfully!',
                                showHideTransition: 'slide',
                                icon: 'success',
                                position: 'top-right',
                                allowToastClose: true,
                                stack: false,
                            })
                            $('.partial').load('@Url.Action("Search", "Students")')
                        },
                        error: function (error) {
                            $.toast({
                                heading: 'Error',
                                text: error,
                                showHideTransition: 'fade',
                                icon: 'error',
                                position: 'top-right',
                                allowToastClose: true,
                                stack: false,
                            })
                        }
                    });
                });
            })
        })

        // delete 
        

    })
</script>